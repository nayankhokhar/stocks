<ion-header [translucent]="true" class="ion-no-border">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/"></ion-back-button>
    </ion-buttons>
    <ion-title>Diversify Shorted</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding page-background">
  <div class="header-section">
    <h1>Market Insights</h1>
    <p>Analyze the best performing mutual funds.</p>
  </div>

  <div class="data-section" *ngIf="!isLoading && allFundsData.length > 0">
    <ion-card class="table-card">
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th rowspan="2">Fund Name</th>
              <th class="period-header">1 Year</th>
              <th class="period-header">3 Year</th>
              <th class="period-header">5 Year</th>
              <th class="period-header">Since Inception</th>
              <th rowspan="2">Exp Ratio</th>
              <th rowspan="2">Exit Load</th>
            </tr>
            <tr class="sub-header-row">
              <!-- Sub-headers visually represented in content or just one header per block -->
              <!-- Let's just use the main header and stack content -->
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let fund of allFundsData">
              <td class="fund-name-cell">
                <div class="fund-name">{{ fund.name }}</div>
                <div class="fund-category" *ngIf="fund.meta">{{ fund.meta.scheme_category }}</div>
              </td>

              <!-- 1 Year -->
              <td class="metrics-cell">
                <div class="metric-row">
                  <span class="label">Ann:</span>
                  <span class="value" [class.positive]="parseFloat(fund.performance?.oneYear?.cagr || '0') > 0">{{
                    fund.performance?.oneYear?.cagr }}</span>
                </div>
                <div class="metric-row">
                  <span class="label">Avg:</span>
                  <span class="value" [class.positive]="parseFloat(fund.performance?.oneYear?.avg || '0') > 0">{{
                    fund.performance?.oneYear?.avg }}</span>
                </div>
                <div class="metric-row">
                  <span class="label">XIRR:</span>
                  <span class="value" [class.positive]="parseFloat(fund.performance?.oneYear?.xirr || '0') > 0">{{
                    fund.performance?.oneYear?.xirr }}</span>
                </div>
                <div class="metric-row">
                  <span class="label">Abs:</span>
                  <span class="value" [class.positive]="parseFloat(fund.performance?.oneYear?.abs || '0') > 0">{{
                    fund.performance?.oneYear?.abs }}</span>
                </div>
                <div class="metric-row">
                  <span class="label">Start:</span>
                  <span class="value">{{ fund.performance?.oneYear?.startNav }}</span>
                </div>
                <div class="metric-row">
                  <span class="label">End:</span>
                  <span class="value">{{ fund.performance?.oneYear?.endNav }}</span>
                </div>
              </td>

              <!-- 3 Year -->
              <td class="metrics-cell">
                <div class="metric-row">
                  <span class="label">Ann:</span>
                  <span class="value" [class.positive]="parseFloat(fund.performance?.threeYear?.cagr || '0') > 0">{{
                    fund.performance?.threeYear?.cagr }}</span>
                </div>
                <div class="metric-row">
                  <span class="label">Avg:</span>
                  <span class="value" [class.positive]="parseFloat(fund.performance?.threeYear?.avg || '0') > 0">{{
                    fund.performance?.threeYear?.avg }}</span>
                </div>
                <div class="metric-row">
                  <span class="label">XIRR:</span>
                  <span class="value" [class.positive]="parseFloat(fund.performance?.threeYear?.xirr || '0') > 0">{{
                    fund.performance?.threeYear?.xirr }}</span>
                </div>
                <div class="metric-row">
                  <span class="label">Abs:</span>
                  <span class="value" [class.positive]="parseFloat(fund.performance?.threeYear?.abs || '0') > 0">{{
                    fund.performance?.threeYear?.abs }}</span>
                </div>
                <div class="metric-row">
                  <span class="label">Start:</span>
                  <span class="value">{{ fund.performance?.threeYear?.startNav }}</span>
                </div>
                <div class="metric-row">
                  <span class="label">End:</span>
                  <span class="value">{{ fund.performance?.threeYear?.endNav }}</span>
                </div>
              </td>

              <!-- 5 Year -->
              <td class="metrics-cell">
                <div class="metric-row">
                  <span class="label">Ann:</span>
                  <span class="value" [class.positive]="parseFloat(fund.performance?.fiveYear?.cagr || '0') > 0">{{
                    fund.performance?.fiveYear?.cagr }}</span>
                </div>
                <div class="metric-row">
                  <span class="label">Avg:</span>
                  <span class="value" [class.positive]="parseFloat(fund.performance?.fiveYear?.avg || '0') > 0">{{
                    fund.performance?.fiveYear?.avg }}</span>
                </div>
                <div class="metric-row">
                  <span class="label">XIRR:</span>
                  <span class="value" [class.positive]="parseFloat(fund.performance?.fiveYear?.xirr || '0') > 0">{{
                    fund.performance?.fiveYear?.xirr }}</span>
                </div>
                <div class="metric-row">
                  <span class="label">Abs:</span>
                  <span class="value" [class.positive]="parseFloat(fund.performance?.fiveYear?.abs || '0') > 0">{{
                    fund.performance?.fiveYear?.abs }}</span>
                </div>
                <div class="metric-row">
                  <span class="label">Start:</span>
                  <span class="value">{{ fund.performance?.fiveYear?.startNav }}</span>
                </div>
                <div class="metric-row">
                  <span class="label">End:</span>
                  <span class="value">{{ fund.performance?.fiveYear?.endNav }}</span>
                </div>
              </td>

              <!-- Total -->
              <td class="metrics-cell">
                <div class="metric-row">
                  <span class="label">Ann:</span>
                  <span class="value" [class.positive]="parseFloat(fund.performance?.total?.cagr || '0') > 0">{{
                    fund.performance?.total?.cagr }}</span>
                </div>
                <div class="metric-row">
                  <span class="label">Avg:</span>
                  <span class="value" [class.positive]="parseFloat(fund.performance?.total?.avg || '0') > 0">{{
                    fund.performance?.total?.avg }}</span>
                </div>
                <div class="metric-row">
                  <span class="label">XIRR:</span>
                  <span class="value" [class.positive]="parseFloat(fund.performance?.total?.xirr || '0') > 0">{{
                    fund.performance?.total?.xirr }}</span>
                </div>
                <div class="metric-row">
                  <span class="label">Abs:</span>
                  <span class="value" [class.positive]="parseFloat(fund.performance?.total?.abs || '0') > 0">{{
                    fund.performance?.total?.abs }}</span>
                </div>
                <div class="metric-row">
                  <span class="label">Start:</span>
                  <span class="value">{{ fund.performance?.total?.startNav }}</span>
                </div>
                <div class="metric-row">
                  <span class="label">End:</span>
                  <span class="value">{{ fund.performance?.total?.endNav }}</span>
                </div>
              </td>

              <td class="meta-cell">{{ fund.expenseRatio }}</td>
              <td class="meta-cell">{{ fund.exitLoad }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </ion-card>
  </div>

  <div class="loading-container" *ngIf="isLoading">
    <ion-spinner name="crescent" color="primary"></ion-spinner>
    <p>Fetching market data...</p>
  </div>

  <div *ngIf="!isLoading && allFundsData.length === 0" class="empty-state">
    <ion-icon name="alert-circle-outline"></ion-icon>
    <p>Unable to load fund details.</p>
  </div>

</ion-content>