<ion-content [fullscreen]="true">
  <div class="row px-3 pt-3">
    <div class="col-4 offset-8 d-flex justify-content-end">
      <ion-list class="w-100">
        <ion-item>
          <ion-select aria-label="Sector" label="Sector" placeholder="Select Sector" [multiple]="true"
            [(ngModel)]="selectedSectors" (ionChange)="onSectorSelect($event)">
            <ion-select-option *ngFor="let sector of sectors" [value]="sector">
              {{ sector }}
            </ion-select-option>
          </ion-select>
        </ion-item>
      </ion-list>
    </div>
  </div>

  <div class="p-3">
    <div class="table-responsive">
      <table class="table table-striped table-bordered">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">Rating</th>
            <th scope="col">Company</th>
            <th scope="col" class="text-end">CMP</th>
            <th scope="col" class="text-end">Market Cap</th>
            <th scope="col" class="text-end">52-WH</th>
            <th scope="col" class="text-end">52-WL</th>
            <th scope="col" class="text-end">PE</th>
            <th scope="col" class="text-end">PB</th>
            <th scope="col" class="text-end">Book Value</th>
            <th scope="col" class="text-end">Div.</th>
            <th scope="col" class="text-center">History</th>
            <th scope="col" class="text-center">Holding</th>
            <th scope="col" class="text-center">Quarterly Results</th>
            <th scope="col" class="text-center">Yearly Results</th>
            <th scope="col" class="text-center">Balance Sheet</th>
            <th scope="col" class="text-center">Cash Flow</th>
            <th scope="col" class="text-center">Dividend</th>
            <th scope="col" class="text-center">Dividend Yearly</th>
          </tr>
        </thead>
        <tbody>
          <ng-container *ngFor="let data of stocks; let i = index">
            <tr class="fw-700">
              <td class="test-start">{{ i + 1 }}</td>
              <td class="test-start">{{ data.totalGreenCount }}</td>
              <td class="test-start" style="color: green;">{{ data.symbol }} : {{ data.name }}</td>
              <td class="text-end" style="color: royalblue;">{{
                formatIndianCurrency(data.currentMarketPrice) }}</td>
              <td class="text-end">{{ formatIndianCurrency(data.marketCap) }}</td>
              <td class="text-end" style="color: red;">{{ formatIndianCurrency(data.last52WeekHigh) }}
                / {{data.last52WeekHighPer }}</td>
              <td class="text-end" style="color: green;">{{ formatIndianCurrency(data.last52WeekLow) }}
                / {{data.last52WeekLowPer }}</td>
              <td class="text-end">
                <span [ngStyle]="{'color': data.peRatio < data.industryPeRatio ? 'green' : 'red'}">
                  {{ formatIndianCurrency(data.peRatio) }}
                </span>
                / {{
                formatIndianCurrency(data.industryPeRatio) }}
              </td>
              <td class="text-end">{{
                formatIndianCurrency(data.pbRatio) }}</td>
              <td class="text-end">{{
                formatIndianCurrency(data.bookValue) }}</td>
              <td class="text-end">
                {{data.crntDividend}}%
              </td>
              <!-- History -->
              <td class="text-end p-0">
                <table class="table table-striped table-bordered table-sm text-end mb-0">
                  <thead>
                    <tr>
                      <th class="pad-1">Date</th>
                      <th class="pad-1">Price</th>
                      <th class="pad-1">Gain/Loss</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let history of data.last10DaysHistory">
                      <td class="pad-1">{{ history.date }}</td>
                      <td class="pad-1">{{ history.close.toFixed(2) }}</td>
                      <td class="pad-1" [ngStyle]="{'color': history.gainLoss.startsWith('-') ? 'red' : 'green'}">
                        {{ history.gainLoss }}
                      </td>
                    </tr>
                  </tbody>
                </table>
              </td>

              <!-- Holding -->
              <td class="text-end p-0">
                <table class="table table-striped table-bordered table-sm text-end mb-0">
                  <thead>
                    <tr>
                      <th class="pad-1">Date</th>
                      <th class="pad-1">Promoters</th>
                      <th class="pad-1">Public</th>
                      <th class="pad-1">DIIs</th>
                      <th class="pad-1">FIIs</th>
                      <th class="pad-1">Pledged</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let holding of data.shareHoldings; let i = index">
                      <td class="pad-1">{{ holding.date }}</td>
                      <td class="pad-1" [ngStyle]="i === (data.shareHoldings).length - 1 ? {}
               : { 'color': holding.promoters >= (data.shareHoldings)[i + 1].promoters ? 'green' : 'red' }">
                        {{ holding.promoters }}%
                      </td>
                      <td class="pad-1" [ngStyle]="i === (data.shareHoldings).length - 1 ? {}
               : { 'color': holding.public <= (data.shareHoldings)[i + 1].public ? 'green' : 'red' }">
                        {{ holding.public }}%
                      </td>
                      <td class="pad-1" [ngStyle]="i === (data.shareHoldings).length - 1 ? {}
               : { 'color': holding.diis >= (data.shareHoldings)[i + 1].diis ? 'green' : 'red' }">
                        {{ holding.diis }}%
                      </td>
                      <td class="pad-1" [ngStyle]="i === (data.shareHoldings).length - 1 ? {}
               : { 'color': holding.fiis >= (data.shareHoldings)[i + 1].fiis ? 'green' : 'red' }">
                        {{ holding.fiis }}%
                      </td>
                      <td class="pad-1" [ngStyle]="i === (data.shareHoldings).length - 1 ? {}
               : { 'color': holding.pledged <= (data.shareHoldings)[i + 1].pledged ? 'green' : 'red' }">
                        {{ holding.pledged }}%
                      </td>
                    </tr>
                  </tbody>
                </table>
              </td>

              <!-- Quarterly Consolidated Results -->
              <td class="text-end p-0">
                <table class="table table-striped table-bordered table-sm text-end mb-0">
                  <thead>
                    <tr>
                      <th class="pad-1">Date</th>
                      <th class="pad-1">Income</th>
                      <th class="pad-1">O.Income</th>
                      <th class="pad-1">I.G.</th>
                      <th class="pad-1">Interest</th>
                      <th class="pad-1">Net Profit</th>
                      <th class="pad-1">NP.G.</th>
                      <th class="pad-1">Margin</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr
                      *ngFor="let item of (data.quarterlyResultC && data.quarterlyResultC.length > 0 ? data.quarterlyResultC : data.quarterlyResultS); let i = index">
                      <td class=" pad-1">
                        {{ item['date'] }}
                      </td>
                      <td class="pad-1" [style.color]="item.totalIncomeColor">
                        {{item.totalIncome | number }}
                      </td>
                      <td class="pad-1" [style.color]="item.otherIncomeColor">
                        {{item.otherIncome | number }}
                      </td>
                      <td class="pad-1"
                        [ngStyle]="i === (data.quarterlyResultC && data.quarterlyResultC.length > 0 ? data.quarterlyResultC : data.quarterlyResultS).length - 1 ? {} 
               : { 'color': item.totalIncomeGrowth > (data.quarterlyResultC && data.quarterlyResultC.length > 0 ? data.quarterlyResultC : data.quarterlyResultS)[i + 1].totalIncomeGrowth ? 'green' : 'red' }">
                        {{ item.totalIncomeGrowth | number }}%
                      </td>
                      <td class="pad-1" [style.color]="item.interestColor">
                        {{ item.interest | number }}
                      </td>
                      <td class="pad-1" [style.color]="item.netProfitColor">
                        {{item.netProfit | number }}
                      </td>
                      <td class="pad-1"
                        [ngStyle]="i === (data.quarterlyResultC && data.quarterlyResultC.length > 0 ? data.quarterlyResultC : data.quarterlyResultS).length - 1 ? {}
               : { 'color': item.netProfitGrowth > (data.quarterlyResultC && data.quarterlyResultC.length > 0 ? data.quarterlyResultC : data.quarterlyResultS)[i + 1].netProfitGrowth ? 'green' : 'red' }">
                        {{ item.netProfitGrowth | number }}%
                      </td>
                      <td class="pad-1" [style.color]="item.netProfitMarginGrowthColor">
                        {{item.netProfitMargin | number }}%
                      </td>
                    </tr>
                  </tbody>
                </table>
              </td>

              <!-- Yearly Consolidated Results -->
              <td class="text-end p-0">
                <table class="table table-striped table-bordered table-sm text-end mb-0">
                  <thead>
                    <tr>
                      <th class="pad-1">Date</th>
                      <th class="pad-1">Income</th>
                      <th class="pad-1">O.Income</th>
                      <th class="pad-1">I.G.</th>
                      <th class="pad-1">Interest</th>
                      <th class="pad-1">Net Profit</th>
                      <th class="pad-1">NP.G.</th>
                      <th class="pad-1">Margin</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr
                      *ngFor="let item of (data.yearlyResultC && data.yearlyResultC.length > 0 ? data.yearlyResultC : data.yearlyResultS); let i = index">
                      <td class=" pad-1">
                        {{ item['date'] }}
                      </td>
                      <td class="pad-1" [style.color]="item.totalIncomeColor">
                        {{item.totalIncome | number }}
                      </td>
                      <td class="pad-1" [style.color]="item.otherIncomeColor">
                        {{item.otherIncome | number }}
                      </td>
                      <td class="pad-1"
                        [ngStyle]="i === (data.yearlyResultC && data.yearlyResultC.length > 0 ? data.yearlyResultC : data.yearlyResultS).length - 1 ? {} 
               : { 'color': item.totalIncomeGrowth > (data.yearlyResultC && data.yearlyResultC.length > 0 ? data.yearlyResultC : data.yearlyResultS)[i + 1].totalIncomeGrowth ? 'green' : 'red' }">
                        {{ item.totalIncomeGrowth | number }}%
                      </td>
                      <td class="pad-1" [style.color]="item.interestColor">
                        {{ item.interest | number }}
                      </td>
                      <td class="pad-1" [style.color]="item.netProfitColor">
                        {{item.netProfit | number }}
                      </td>
                      <td class="pad-1"
                        [ngStyle]="i === (data.yearlyResultC && data.yearlyResultC.length > 0 ? data.yearlyResultC : data.yearlyResultS).length - 1 ? {}
               : { 'color': item.netProfitGrowth > (data.yearlyResultC && data.yearlyResultC.length > 0 ? data.yearlyResultC : data.yearlyResultS)[i + 1].netProfitGrowth ? 'green' : 'red' }">
                        {{ item.netProfitGrowth | number }}%
                      </td>
                      <td class="pad-1" [style.color]="item.netProfitMarginGrowthColor">
                        {{item.netProfitMargin | number }}%
                      </td>
                    </tr>
                  </tbody>
                </table>
              </td>

              <!-- Balance Sheet -->
              <td class="text-end p-0">
                <table class="table table-striped table-bordered table-sm text-end mb-0">
                  <thead>
                    <tr>
                      <th class="pad-1">Date</th>
                      <th class="pad-1">S.T.L</th>
                      <th class="pad-1">L.T.L</th>
                      <th class="pad-1">F.A</th>
                      <th class="pad-1">C.A</th>
                      <th class="pad-1">O.A</th>
                      <th class="pad-1">T.A</th>
                      <th class="pad-1">C.L</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr
                      *ngFor="let item of (data.balanceSheetC && data.balanceSheetC.length > 0 ? data.balanceSheetC : data.balanceSheetS); let i = index">
                      <td class=" pad-1">
                        {{ item['date'] }}
                      </td>
                      <td class="pad-1" [style.color]="item.currentLiabilitiesColor">
                        {{item.currentLiabilities | number }}
                      </td>
                      <td class="pad-1" [style.color]="item.otherLiabilitiesColor">
                        {{item.otherLiabilities | number }}
                      </td>
                      <td class="pad-1" [style.color]="item.fixedAssetsColor">
                        {{item.fixedAssets | number }}
                      </td>
                      <td class="pad-1" [style.color]="item.currentAssetsColor">
                        {{item.currentAssets | number }}
                      </td>
                      <td class="pad-1" [style.color]="item.otherAssetsColor">
                        {{item.otherAssets | number }}
                      </td>
                      <td class="pad-1" [style.color]="item.totalAssetsColor">
                        {{item.totalAssets | number }}
                      </td>
                      <td class="pad-1" [style.color]="item.contingentLiabilitiesColor">
                        {{item.contingentLiabilities | number }}
                      </td>
                    </tr>
                  </tbody>
                </table>
              </td>

              <!-- Balance Sheet -->
              <td class="text-end p-0">
                <table class="table table-striped table-bordered table-sm text-end mb-0">
                  <thead>
                    <tr>
                      <th class="pad-1">Date</th>
                      <th class="pad-1">O.A</th>
                      <th class="pad-1">I.A</th>
                      <th class="pad-1">F.A</th>
                      <th class="pad-1">Other</th>
                      <th class="pad-1">N.C.F</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr
                      *ngFor="let item of (data.cashFlowC && data.cashFlowC.length > 0 ? data.cashFlowC : data.cashFlowS); let i = index">
                      <td class="pad-1">
                        {{ item['date'] }}
                      </td>
                      <td class="pad-1" [style.color]="item.operatingActivitiesColor">
                        {{item.operatingActivities | number }}
                      </td>
                      <td class="pad-1" [style.color]="item.investingActivitiesColor">
                        {{item.investingActivities | number }}
                      </td>
                      <td class="pad-1">
                        {{item.financingActivities | number }}
                      </td>
                      <td class="pad-1">
                        {{item.others | number }}
                      </td>
                      <td class="pad-1" [style.color]="item.netCashFlowColor">
                        {{item.netCashFlow | number }}
                      </td>
                    </tr>
                  </tbody>
                </table>
              </td>

              <!-- Dividend -->
              <td class="text-end p-0">
                <table class="table table-striped table-bordered table-sm text-end mb-0">
                  <thead>
                    <tr>
                      <th class="pad-1">Ex Date</th>
                      <th class="pad-1">Div Amt</th>
                      <th class="pad-1">At Price</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let item of data.dividends; let i = index">
                      <td class="pad-1">
                        {{ item.exDate }}
                      </td>
                      <td class="pad-1">
                        {{ item.dividendAmount }} - {{ item.dividendPercent }}%
                      </td>
                      <td class="pad-1">
                        {{ item.announceDayPrice }}
                      </td>
                    </tr>
                  </tbody>
                </table>
              </td>

              <!-- Dividend Yearly-->
              <td class="text-end p-0">
                <table class="table table-striped table-bordered table-sm text-end mb-0">
                  <thead>
                    <tr>
                      <th class="pad-1">Year</th>
                      <th class="pad-1">Div Total</th>
                      <th class="pad-1">At Price</th>
                      <th class="pad-1">Months</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let item of data.dividendsYearly; let i = index">
                      <td class="pad-1">
                        {{ item.year }}
                      </td>
                      <td class="pad-1">
                        {{ item.totalDividendAmount }} - {{ item.totalDividendPercent }}%
                      </td>
                      <td class="pad-1">
                        {{ item.avgAnnouncePrice }}
                      </td>
                      <td class="pad-1">
                        {{ item.months }}
                      </td>
                    </tr>
                  </tbody>
                </table>
              </td>
          </ng-container>
        </tbody>
      </table>
    </div>
  </div>
</ion-content>